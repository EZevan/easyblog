## <center>自动化 - 浅谈UI自动化</center>

> UI自动化的价值  

* 错误认知：UI自动化实现了，测试就可以不用测了；让UI自动化去验证UI。  

UI自动化真正的价值主要表下为以下两点：

1. 验证逻辑而非UI
UI的验证会引入许多不稳定因素。UI是互联网应用程序变化最大最频繁的，对界面的各种控件，诸如按钮，文本框，选项，颜色，布局等的验证，做的越多，用例越不稳定；这导致最终UI自动化偏离了其落地的实现的初衷。UI自动化能做的恰恰是对业务逻辑的验证，或者说对程序功能的验证，我们也称其功能自动化。举个简单例子：验证用户登陆是否成功，验证增删改查是否成功等，这种业务逻辑的结果只会是“是”和“否”其中一个，因此稳定性能得到保证。

2. 代替大量重复操作
对于UI自动化的执行成本是很高的，如何使其价值最大化，就是在既有的成本上提高数量。比如每个迭代相同功能的回归测试验证；手机游戏包，上百个市场包的编译发布等；

> 难点：维护成本

1. 对于录制的自动化脚本，一方面调试，排错，优化等都需要花费大量时间；另外录制的脚本基本没有架构，设计模式可言；特别是当需求发生较大变化，业务逻辑变更后，原有的脚本逻辑无法使用，重新录制脚本使得原有的付出归零。

2. 对于使用成熟自动化框架+良好的代码设计模式的自动化架构，依然存在无法规避的客观影响 -- 需求变更。无论是UI的变化亦或是逻辑的变化，修改脚本是必然的，所以维护成本也就是客观存在的。

所以为了最大程度的降低维护成本，建议我们从以下两点考虑：一是策略，二是技术

**策略上**，维护成本的控制，脚本要有序的上，先做核心的BVT（版本验证测试），人均维护1-2个脚本；定个稳定运营一个月的目标，后面增加的脚本在测试环境稳定跑上一周，才能切到正式环境；定期培训，分享写脚本过程中遇到的坑，总结出最佳实践；团队应积极提高代码质量，UI自动化不单是简单的工作任务，更重要的是过程中收获的知识，经验的积累，是自我提升有效手段。

**技术上**，降低维护成本的方法：
1. **脚本中不要有坐标，图像识别等**，不要试图将类似的不稳定因素放到脚本中。
2. **脚本永远不要有sleep**，sleep是UI自动化稳定性的最大克星之一。尽量使用隐式/显示等待，而不是直接阻塞线程
3. **脚本要面向对象**，典型的就是POM，遵循代码设计的SOLID原则，提升代码的可维护性，可扩展性。
4. **控件定位**，对于常见的基于react库的SPA（单页应用），元素id定位什么的基本不存在，合理使用用XPath以及CssSelector能极大提高元素的可定位性以及脚本性能
5. **通过分步操作化繁为简**，UI自动化脚本一大特色就是长，一个脚本通常希望验证好几点，比如登陆，打开列表，选择项目，进入系统；这时候最好将每个步骤作为一个用例，出了问题，集中排查某个步骤的日志就行了。执行的时候，按照顺序将用例合并执行即可。
6. **稳定的环境**，包括网络，系统，账号资源，电脑，服务器等。

> 执行每个用例重启一次浏览器的利弊    

弊端：
1. 每次重启浏览器，会生成几十MB大小的缓存在硬盘，自动化测试用例过多的情况下会使得磁盘爆满，系统速度缓慢
2. 重启是需要时间的，重启的速度取决于电脑的速度，还有磁盘的io，当然还有浏览器的类型。
3. 重启会加大整个自动化测试程序的不稳定性，因为有的机器可能会关闭失败，当然我们采取的是分布式自动化测试，执行卡死的机器就直接略过，他的任务会被其他正常的机器取代
4. driver进程在重启过程中会不断增加，最后使得机器进程过多卡死，但是这点只需要通过简单的taskkill命令就可以解决了(quit driver即可)
5. 有些用例之间如果有衔接，重启的话可能会重复一些操作，以致于使得自动化测试脚本变多。  

好处：  
1. 每个用例执行必然会在浏览器留下一些记录，特别是cookie，比如你执行两个登陆操作，如果不重启浏览器，可能第二个用例登陆就登陆不了。
2. 符合自动化测试用例设计的 "用例原子性"问题，用例和用例之间不存在干扰，不然可能会出现自动化测试结果相互干扰的问题。

当然随着测试理论的变化，这些会变，如果自动化测试框架是分布式的，重启浏览器所损耗的时间可以忽略。
